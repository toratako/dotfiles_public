#!/usr/bin/env bash

exists() {
	for c in "$@"; do
		if command -v "$c" >/dev/null; then
			continue
		else
			return $?
		fi
	done
	return 0
}

mime_type=$(file --dereference --brief --mime-type "$1")
mime_category=$(echo "$mime_type" | sed 's|/.*||')

if [ -d "$1" ]; then
	if exists eza; then
		eza --group-directories-first -1 -l -F -a -b -hl --icons=always --color=always "$1"
		exit 0
	fi
elif [ "$mime_category" = "image" ]; then
	if exists chafa; then
		# https://www.arewesixelyet.com/#wezterm
		# ^ wezterm supports sixel graphics but it fails to render images. Use symbols instead.
		chafa -f "symbols" --fit-width --exact-size off "$1"
		# no return for handle exif data in lesspipe
	fi
else
	exit 1
fi

exit 1
